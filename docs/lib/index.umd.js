!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).SpatialId={})}(this,function(t){"use strict";const e={f:0,x:0,y:0,z:0},r=180/Math.PI;function n(t,e=1){const{f:r,x:n,y:o,z:i}=t;if(e<=0)throw new Error("steps must be greater than 0");if(e>i)throw new Error(`Getting parent tile of ${t}, ${e} steps is not possible because it would go beyond the root tile (z=0)`);return{f:r>>e,x:n>>e,y:o>>e,z:i-e}}function o(t=e){const{f:r,x:n,y:o,z:i}=t;return[{f:2*r,x:2*n,y:2*o,z:i+1},{f:2*r,x:2*n+1,y:2*o,z:i+1},{f:2*r,x:2*n,y:2*o+1,z:i+1},{f:2*r,x:2*n+1,y:2*o+1,z:i+1},{f:2*r+1,x:2*n,y:2*o,z:i+1},{f:2*r+1,x:2*n+1,y:2*o,z:i+1},{f:2*r+1,x:2*n,y:2*o+1,z:i+1},{f:2*r+1,x:2*n+1,y:2*o+1,z:i+1}]}function i(t=e){const{f:r,x:n,y:o,z:i}=t;return[f({f:r,x:n,y:o,z:i}),f({f:r,x:n+1,y:o,z:i}),f({f:r,x:n,y:o+1,z:i}),f({f:r,x:n+1,y:o+1,z:i}),f({f:r,x:n-1,y:o,z:i}),f({f:r,x:n,y:o-1,z:i}),f({f:r,x:n-1,y:o-1,z:i}),f({f:r,x:n+1,y:o-1,z:i}),f({f:r,x:n-1,y:o+1,z:i})]}function a(t){const e=Math.PI-2*Math.PI*t.y/Math.pow(2,t.z);return{lng:t.x/Math.pow(2,t.z)*360-180,lat:r*Math.atan(.5*(Math.exp(e)-Math.exp(-e)))}}function s(t){return a({x:2*t.x+1,y:2*t.y+1,z:t.z+1})}function u(t){return[a(t),a({...t,y:t.y+1,x:t.x+1})]}function l(t){return 33554432*t.f/2**t.z}function f(t){const{z:e,f:r,x:n,y:o}=t;return{z:e,f:Math.max(Math.min(r,2**e),-(2**e)),x:n<0?n+2**e:n%2**e,y:o<0?o+2**e:o%2**e}}function c(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function h(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return c({type:"LineString",coordinates:t},e,r)}function y(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function g(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function d(t,e,r){if(null!==t)for(var n,o,i,a,s,u,l,f,c=0,h=0,y=t.type,g="FeatureCollection"===y,p="Feature"===y,m=g?t.features.length:1,v=0;v<m;v++){s=(f=!!(l=g?t.features[v].geometry:p?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var x=0;x<s;x++){var w=0,b=0;if(null!==(a=f?l.geometries[x]:l)){u=a.coordinates;var M=a.type;switch(c=0,M){case null:break;case"Point":if(!1===e(u,h,v,w,b))return!1;h++,w++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(!1===e(u[n],h,v,w,b))return!1;h++,"MultiPoint"===M&&w++}"LineString"===M&&w++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(o=0;o<u[n].length-c;o++){if(!1===e(u[n][o],h,v,w,b))return!1;h++}"MultiLineString"===M&&w++,"Polygon"===M&&b++}"Polygon"===M&&w++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for(b=0,o=0;o<u[n].length;o++){for(i=0;i<u[n][o].length-c;i++){if(!1===e(u[n][o][i],h,v,w,b))return!1;h++}b++}w++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===d(a.geometries[n],e))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function p(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function m(t,e){!function(t,e){var r,n,o,i,a,s,u,l,f,c,h=0,y="FeatureCollection"===t.type,g="Feature"===t.type,d=y?t.features.length:1;for(r=0;r<d;r++){for(s=y?t.features[r].geometry:g?t.geometry:t,l=y?t.features[r].properties:g?t.properties:{},f=y?t.features[r].bbox:g?t.bbox:void 0,c=y?t.features[r].id:g?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,o=0;o<a;o++)if(null!==(i=u?s.geometries[o]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(i,h,l,f,c))return!1;break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(!1===e(i.geometries[n],h,l,f,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,h,l,f,c))return!1;h++}}(t,function(t,r,n,o,i){var a,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==e(c(t,n,{bbox:o,id:i}),r,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<t.coordinates.length;u++){var l=t.coordinates[u];if(!1===e(c({type:a,coordinates:l},n),r,u))return!1}})}function v(t){var e=[1/0,1/0,-1/0,-1/0];return d(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}function x(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function w(t){return"Feature"===t.type?t.geometry:t}function b(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=function(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}(t),o=w(e),i=o.type,a=e.bbox,s=o.coordinates;if(a&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(n,a))return!1;"Polygon"===i&&(s=[s]);for(var u=!1,l=0;l<s.length&&!u;l++)if(M(n,s[l][0],r.ignoreBoundary)){for(var f=!1,c=1;c<s[l].length&&!f;)M(n,s[l][c],!r.ignoreBoundary)&&(f=!0),c++;f||(u=!0)}return u}function M(t,e,r){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var o=0,i=e.length-1;o<e.length;i=o++){var a=e[o][0],s=e[o][1],u=e[i][0],l=e[i][1];if(t[1]*(a-u)+s*(u-t[0])+l*(t[0]-a)===0&&(a-t[0])*(u-t[0])<=0&&(s-t[1])*(l-t[1])<=0)return!r;s>t[1]!=l>t[1]&&t[0]<(u-a)*(t[1]-s)/(l-s)+a&&(n=!n)}return n}function P(t){if(!t)throw new Error("geojson is required");var e=[];return m(t,function(t){!function(t,e){var r=[],n=t.geometry;if(null!==n){switch(n.type){case"Polygon":r=x(n);break;case"LineString":r=[x(n)]}r.forEach(function(r){var n=function(t,e){var r=[];return t.reduce(function(t,n){var o,i,a,s,u,l,f=h([t,n],e);return f.bbox=(i=n,a=(o=t)[0],s=o[1],u=i[0],l=i[1],[a<u?a:u,s<l?s:l,a>u?a:u,s>l?s:l]),r.push(f),n}),r}(r,t.properties);n.forEach(function(t){t.id=e.length,e.push(t)})})}}(t,e)}),y(e)}function z(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}v.default=v;var E,S={exports:{}},F={exports:{}};function X(){return E||(E=1,function(t){t.exports=function(){function t(t,n,o,i,a){!function t(r,n,o,i,a){for(;i>o;){if(i-o>600){var s=i-o+1,u=n-o+1,l=Math.log(s),f=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*f*(s-f)/s)*(u-s/2<0?-1:1);t(r,n,Math.max(o,Math.floor(n-u*f/s+c)),Math.min(i,Math.floor(n+(s-u)*f/s+c)),a)}var h=r[n],y=o,g=i;for(e(r,o,n),a(r[i],h)>0&&e(r,o,i);y<g;){for(e(r,y,g),y++,g--;a(r[y],h)<0;)y++;for(;a(r[g],h)>0;)g--}0===a(r[o],h)?e(r,o,g):e(r,++g,i),g<=n&&(o=g+1),n<=g&&(i=g-1)}}(t,n,o||0,i||t.length-1,a||r)}function e(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function r(t,e){return t<e?-1:t>e?1:0}var n=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function i(t,e){a(t,0,t.children.length,e,t)}function a(t,e,r,n,o){o||(o=g(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var i=e;i<r;i++){var a=t.children[i];s(o,t.leaf?n(a):a)}return o}function s(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function c(t){return t.maxX-t.minX+(t.maxY-t.minY)}function h(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function y(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function g(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(e,r,n,o,i){for(var a=[r,n];a.length;)if(!((n=a.pop())-(r=a.pop())<=o)){var s=r+Math.ceil((n-r)/o/2)*o;t(e,s,r,n,i),a.push(r,s,s,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(t){var e=this.data,r=[];if(!y(t,e))return r;for(var n=this.toBBox,o=[];e;){for(var i=0;i<e.children.length;i++){var a=e.children[i],s=e.leaf?n(a):a;y(t,s)&&(e.leaf?r.push(a):h(t,s)?this._all(a,r):o.push(a))}e=o.pop()}return r},n.prototype.collides=function(t){var e=this.data;if(!y(t,e))return!1;for(var r=[];e;){for(var n=0;n<e.children.length;n++){var o=e.children[n],i=e.leaf?this.toBBox(o):o;if(y(t,i)){if(e.leaf||h(t,i))return!0;r.push(o)}}e=r.pop()}return!1},n.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},n.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},n.prototype.clear=function(){return this.data=g([]),this},n.prototype.remove=function(t,e){if(!t)return this;for(var r,n,i,a=this.data,s=this.toBBox(t),u=[],l=[];a||u.length;){if(a||(a=u.pop(),n=u[u.length-1],r=l.pop(),i=!0),a.leaf){var f=o(t,a.children,e);if(-1!==f)return a.children.splice(f,1),u.push(a),this._condense(u),this}i||a.leaf||!h(a,s)?n?(r++,a=n.children[r],i=!1):a=null:(u.push(a),l.push(r),r=0,n=a,a=a.children[0])}return this},n.prototype.toBBox=function(t){return t},n.prototype.compareMinX=function(t,e){return t.minX-e.minX},n.prototype.compareMinY=function(t,e){return t.minY-e.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(t){return this.data=t,this},n.prototype._all=function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},n.prototype._build=function(t,e,r,n){var o,a=r-e+1,s=this._maxEntries;if(a<=s)return i(o=g(t.slice(e,r+1)),this.toBBox),o;n||(n=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,n-1))),(o=g([])).leaf=!1,o.height=n;var u=Math.ceil(a/s),l=u*Math.ceil(Math.sqrt(s));d(t,e,r,l,this.compareMinX);for(var f=e;f<=r;f+=l){var c=Math.min(f+l-1,r);d(t,f,c,u,this.compareMinY);for(var h=f;h<=c;h+=u){var y=Math.min(h+u-1,c);o.children.push(this._build(t,h,y,n-1))}}return i(o,this.toBBox),o},n.prototype._chooseSubtree=function(t,e,r,n){for(;n.push(e),!e.leaf&&n.length-1!==r;){for(var o=1/0,i=1/0,a=void 0,s=0;s<e.children.length;s++){var u=e.children[s],l=f(u),c=(h=t,y=u,(Math.max(y.maxX,h.maxX)-Math.min(y.minX,h.minX))*(Math.max(y.maxY,h.maxY)-Math.min(y.minY,h.minY))-l);c<i?(i=c,o=l<o?l:o,a=u):c===i&&l<o&&(o=l,a=u)}e=a||e.children[0]}var h,y;return e},n.prototype._insert=function(t,e,r){var n=r?t:this.toBBox(t),o=[],i=this._chooseSubtree(n,this.data,e,o);for(i.children.push(t),s(i,n);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(n,o,e)},n.prototype._split=function(t,e){var r=t[e],n=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,n);var a=this._chooseSplitIndex(r,o,n),s=g(r.children.splice(a,r.children.length-a));s.height=r.height,s.leaf=r.leaf,i(r,this.toBBox),i(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)},n.prototype._splitRoot=function(t,e){this.data=g([t,e]),this.data.height=t.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(t,e,r){for(var n,o,i,s,u,l,c,h=1/0,y=1/0,g=e;g<=r-e;g++){var d=a(t,0,g,this.toBBox),p=a(t,g,r,this.toBBox),m=(o=d,i=p,s=void 0,u=void 0,l=void 0,c=void 0,s=Math.max(o.minX,i.minX),u=Math.max(o.minY,i.minY),l=Math.min(o.maxX,i.maxX),c=Math.min(o.maxY,i.maxY),Math.max(0,l-s)*Math.max(0,c-u)),v=f(d)+f(p);m<h?(h=m,n=g,y=v<y?v:y):m===h&&v<y&&(y=v,n=g)}return n||r-e},n.prototype._chooseSplitAxis=function(t,e,r){var n=t.leaf?this.compareMinX:u,o=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,o)&&t.children.sort(n)},n.prototype._allDistMargin=function(t,e,r,n){t.children.sort(n);for(var o=this.toBBox,i=a(t,0,e,o),u=a(t,r-e,r,o),l=c(i)+c(u),f=e;f<r-e;f++){var h=t.children[f];s(i,t.leaf?o(h):h),l+=c(i)}for(var y=r-e-1;y>=e;y--){var g=t.children[y];s(u,t.leaf?o(g):g),l+=c(u)}return l},n.prototype._adjustParentBBoxes=function(t,e,r){for(var n=r;n>=0;n--)s(e[n],t)},n.prototype._condense=function(t){for(var e=t.length-1,r=void 0;e>=0;e--)0===t[e].children.length?e>0?(r=t[e-1].children).splice(r.indexOf(t[e]),1):this.clear():i(t[e],this.toBBox)},n}()}(F)),F.exports}var Y,L={};function _(){return Y||(Y=1,function(t){function e(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function r(t,r,n){if(void 0===n&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!h(t[0])||!h(t[1]))throw new Error("coordinates must contain numbers");return e({type:"Point",coordinates:t},r,n)}function n(t,r,n){void 0===n&&(n={});for(var o=0,i=t;o<i.length;o++){var a=i[o];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return e({type:"Polygon",coordinates:t},r,n)}function o(t,r,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return e({type:"LineString",coordinates:t},r,n)}function i(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function a(t,r,n){return void 0===n&&(n={}),e({type:"MultiLineString",coordinates:t},r,n)}function s(t,r,n){return void 0===n&&(n={}),e({type:"MultiPoint",coordinates:t},r,n)}function u(t,r,n){return void 0===n&&(n={}),e({type:"MultiPolygon",coordinates:t},r,n)}function l(e,r){void 0===r&&(r="kilometers");var n=t.factors[r];if(!n)throw new Error(r+" units is invalid");return e*n}function f(e,r){void 0===r&&(r="kilometers");var n=t.factors[r];if(!n)throw new Error(r+" units is invalid");return e/n}function c(t){return 180*(t%(2*Math.PI))/Math.PI}function h(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:1.0936*t.earthRadius},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=e,t.geometry=function(t,e,i){switch(t){case"Point":return r(e).geometry;case"LineString":return o(e).geometry;case"Polygon":return n(e).geometry;case"MultiPoint":return s(e).geometry;case"MultiLineString":return a(e).geometry;case"MultiPolygon":return u(e).geometry;default:throw new Error(t+" is invalid")}},t.point=r,t.points=function(t,e,n){return void 0===n&&(n={}),i(t.map(function(t){return r(t,e)}),n)},t.polygon=n,t.polygons=function(t,e,r){return void 0===r&&(r={}),i(t.map(function(t){return n(t,e)}),r)},t.lineString=o,t.lineStrings=function(t,e,r){return void 0===r&&(r={}),i(t.map(function(t){return o(t,e)}),r)},t.featureCollection=i,t.multiLineString=a,t.multiPoint=s,t.multiPolygon=u,t.geometryCollection=function(t,r,n){return void 0===n&&(n={}),e({type:"GeometryCollection",geometries:t},r,n)},t.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r},t.radiansToLength=l,t.lengthToRadians=f,t.lengthToDegrees=function(t,e){return c(f(t,e))},t.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},t.radiansToDegrees=c,t.degreesToRadians=function(t){return t%360*Math.PI/180},t.convertLength=function(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),!(t>=0))throw new Error("length must be a positive number");return l(f(t,e),r)},t.convertArea=function(e,r,n){if(void 0===r&&(r="meters"),void 0===n&&(n="kilometers"),!(e>=0))throw new Error("area must be a positive number");var o=t.areaFactors[r];if(!o)throw new Error("invalid original units");var i=t.areaFactors[n];if(!i)throw new Error("invalid final units");return e/o*i},t.isNumber=h,t.isObject=function(t){return!!t&&t.constructor===Object},t.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!h(t))throw new Error("bbox must only contain numbers")})},t.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}}(L)),L}var k,B={};function A(){if(k)return B;k=1,Object.defineProperty(B,"__esModule",{value:!0});var t=_();function e(t,r,n){if(null!==t)for(var o,i,a,s,u,l,f,c,h=0,y=0,g=t.type,d="FeatureCollection"===g,p="Feature"===g,m=d?t.features.length:1,v=0;v<m;v++){u=(c=!!(f=d?t.features[v].geometry:p?t.geometry:t)&&"GeometryCollection"===f.type)?f.geometries.length:1;for(var x=0;x<u;x++){var w=0,b=0;if(null!==(s=c?f.geometries[x]:f)){l=s.coordinates;var M=s.type;switch(h=!n||"Polygon"!==M&&"MultiPolygon"!==M?0:1,M){case null:break;case"Point":if(!1===r(l,y,v,w,b))return!1;y++,w++;break;case"LineString":case"MultiPoint":for(o=0;o<l.length;o++){if(!1===r(l[o],y,v,w,b))return!1;y++,"MultiPoint"===M&&w++}"LineString"===M&&w++;break;case"Polygon":case"MultiLineString":for(o=0;o<l.length;o++){for(i=0;i<l[o].length-h;i++){if(!1===r(l[o][i],y,v,w,b))return!1;y++}"MultiLineString"===M&&w++,"Polygon"===M&&b++}"Polygon"===M&&w++;break;case"MultiPolygon":for(o=0;o<l.length;o++){for(b=0,i=0;i<l[o].length;i++){for(a=0;a<l[o][i].length-h;a++){if(!1===r(l[o][i][a],y,v,w,b))return!1;y++}b++}w++}break;case"GeometryCollection":for(o=0;o<s.geometries.length;o++)if(!1===e(s.geometries[o],r,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function r(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&!1!==e(t.features[r].properties,r);r++);break;case"Feature":e(t.properties,0)}}function n(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function o(t,e){var r,n,o,i,a,s,u,l,f,c,h=0,y="FeatureCollection"===t.type,g="Feature"===t.type,d=y?t.features.length:1;for(r=0;r<d;r++){for(s=y?t.features[r].geometry:g?t.geometry:t,l=y?t.features[r].properties:g?t.properties:{},f=y?t.features[r].bbox:g?t.bbox:void 0,c=y?t.features[r].id:g?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,o=0;o<a;o++)if(null!==(i=u?s.geometries[o]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(i,h,l,f,c))return!1;break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(!1===e(i.geometries[n],h,l,f,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,h,l,f,c))return!1;h++}}function i(e,r){o(e,function(e,n,o,i,a){var s,u=null===e?null:e.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==r(t.feature(e,o,{bbox:i,id:a}),n,0)&&void 0}switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<e.coordinates.length;l++){var f={type:s,coordinates:e.coordinates[l]};if(!1===r(t.feature(f,o),n,l))return!1}})}function a(r,n){i(r,function(r,o,i){var a=0;if(r.geometry){var s=r.geometry.type;if("Point"!==s&&"MultiPoint"!==s){var u,l=0,f=0,c=0;return!1!==e(r,function(e,s,h,y,g){if(void 0===u||o>l||y>f||g>c)return u=e,l=o,f=y,c=g,void(a=0);var d=t.lineString([u,e],r.properties);if(!1===n(d,o,i,g,a))return!1;a++,u=e})&&void 0}}})}function s(e,r){if(!e)throw new Error("geojson is required");i(e,function(e,n,o){if(null!==e.geometry){var i=e.geometry.type,a=e.geometry.coordinates;switch(i){case"LineString":if(!1===r(e,n,o,0,0))return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(!1===r(t.lineString(a[s],e.properties),n,o,s))return!1}}})}return B.coordAll=function(t){var r=[];return e(t,function(t){r.push(t)}),r},B.coordEach=e,B.coordReduce=function(t,r,n,o){var i=n;return e(t,function(t,e,o,a,s){i=0===e&&void 0===n?t:r(i,t,e,o,a,s)},o),i},B.featureEach=n,B.featureReduce=function(t,e,r){var o=r;return n(t,function(t,n){o=0===n&&void 0===r?t:e(o,t,n)}),o},B.findPoint=function(e,r){if(r=r||{},!t.isObject(r))throw new Error("options is invalid");var n,o=r.featureIndex||0,i=r.multiFeatureIndex||0,a=r.geometryIndex||0,s=r.coordIndex||0,u=r.properties;switch(e.type){case"FeatureCollection":o<0&&(o=e.features.length+o),u=u||e.features[o].properties,n=e.features[o].geometry;break;case"Feature":u=u||e.properties,n=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=e;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var l=n.coordinates;switch(n.type){case"Point":return t.point(l,u,r);case"MultiPoint":return i<0&&(i=l.length+i),t.point(l[i],u,r);case"LineString":return s<0&&(s=l.length+s),t.point(l[s],u,r);case"Polygon":return a<0&&(a=l.length+a),s<0&&(s=l[a].length+s),t.point(l[a][s],u,r);case"MultiLineString":return i<0&&(i=l.length+i),s<0&&(s=l[i].length+s),t.point(l[i][s],u,r);case"MultiPolygon":return i<0&&(i=l.length+i),a<0&&(a=l[i].length+a),s<0&&(s=l[i][a].length-s),t.point(l[i][a][s],u,r)}throw new Error("geojson is invalid")},B.findSegment=function(e,r){if(r=r||{},!t.isObject(r))throw new Error("options is invalid");var n,o=r.featureIndex||0,i=r.multiFeatureIndex||0,a=r.geometryIndex||0,s=r.segmentIndex||0,u=r.properties;switch(e.type){case"FeatureCollection":o<0&&(o=e.features.length+o),u=u||e.features[o].properties,n=e.features[o].geometry;break;case"Feature":u=u||e.properties,n=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=e;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var l=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=l.length+s-1),t.lineString([l[s],l[s+1]],u,r);case"Polygon":return a<0&&(a=l.length+a),s<0&&(s=l[a].length+s-1),t.lineString([l[a][s],l[a][s+1]],u,r);case"MultiLineString":return i<0&&(i=l.length+i),s<0&&(s=l[i].length+s-1),t.lineString([l[i][s],l[i][s+1]],u,r);case"MultiPolygon":return i<0&&(i=l.length+i),a<0&&(a=l[i].length+a),s<0&&(s=l[i][a].length-s-1),t.lineString([l[i][a][s],l[i][a][s+1]],u,r)}throw new Error("geojson is invalid")},B.flattenEach=i,B.flattenReduce=function(t,e,r){var n=r;return i(t,function(t,o,i){n=0===o&&0===i&&void 0===r?t:e(n,t,o,i)}),n},B.geomEach=o,B.geomReduce=function(t,e,r){var n=r;return o(t,function(t,o,i,a,s){n=0===o&&void 0===r?t:e(n,t,o,i,a,s)}),n},B.lineEach=s,B.lineReduce=function(t,e,r){var n=r;return s(t,function(t,o,i,a){n=0===o&&void 0===r?t:e(n,t,o,i,a)}),n},B.propEach=r,B.propReduce=function(t,e,n){var o=n;return r(t,function(t,r){o=0===r&&void 0===n?t:e(o,t,r)}),o},B.segmentEach=a,B.segmentReduce=function(t,e,r){var n=r,o=!1;return a(t,function(t,i,a,s,u){n=!1===o&&void 0===r?t:e(n,t,i,a,s,u),o=!0}),n},B}var I,R,C={};function G(){if(I)return C;I=1,Object.defineProperty(C,"__esModule",{value:!0});var t=A();function e(e){var r=[1/0,1/0,-1/0,-1/0];return t.coordEach(e,function(t){r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])}),r}return e.default=e,C.default=e,C}var O=function(){if(R)return S.exports;R=1;var t=X(),e=_(),r=A(),n=G().default,o=r.featureEach;r.coordEach,e.polygon;var i=e.featureCollection;function a(e){var r=new t(e);return r.insert=function(e){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:n(e),t.prototype.insert.call(this,e)},r.load=function(e){var r=[];return Array.isArray(e)?e.forEach(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:n(t),r.push(t)}):o(e,function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:n(t),r.push(t)}),t.prototype.load.call(this,r)},r.remove=function(e,r){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:n(e),t.prototype.remove.call(this,e,r)},r.clear=function(){return t.prototype.clear.call(this)},r.search=function(e){var r=t.prototype.search.call(this,this.toBBox(e));return i(r)},r.collides=function(e){return t.prototype.collides.call(this,this.toBBox(e))},r.all=function(){var e=t.prototype.all.call(this);return i(e)},r.toJSON=function(){return t.prototype.toJSON.call(this)},r.fromJSON=function(e){return t.prototype.fromJSON.call(this,e)},r.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=n(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=n(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},r}return S.exports=a,S.exports.default=a,S.exports}(),j=z(O);function N(t,e){var r={},n=[];if("LineString"===t.type&&(t=c(t)),"LineString"===e.type&&(e=c(e)),"Feature"===t.type&&"Feature"===e.type&&null!==t.geometry&&null!==e.geometry&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var o=T(t,e);return o&&n.push(o),y(n)}var i=j();return i.load(P(e)),p(P(t),function(t){p(i.search(t),function(e){var o=T(t,e);if(o){var i=x(o).join(",");r[i]||(r[i]=!0,n.push(o))}})}),y(n)}function T(t,e){var r=x(t),n=x(e);if(2!==r.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==n.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=r[0][0],i=r[0][1],a=r[1][0],s=r[1][1],u=n[0][0],l=n[0][1],f=n[1][0],h=n[1][1],y=(h-l)*(a-o)-(f-u)*(s-i),d=(f-u)*(i-l)-(h-l)*(o-u),p=(a-o)*(i-l)-(s-i)*(o-u);if(0===y)return null;var m=d/y,v=p/y;return m>=0&&m<=1&&v>=0&&v<=1?function(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!g(t[0])||!g(t[1]))throw new Error("coordinates must contain numbers");return c({type:"Point",coordinates:t},e,r)}([o+m*(a-o),i+m*(s-i)]):null}function $(t,e){void 0===e&&(e={});var r=w(t);switch(e.properties||"Feature"!==t.type||(e.properties=t.properties),r.type){case"Polygon":return function(t,e){void 0===e&&(e={});var r=w(t),n=r.coordinates,o=e.properties?e.properties:"Feature"===t.type?t.properties:{};return q(n,o)}(r,e);case"MultiPolygon":return function(t,e){void 0===e&&(e={});var r=w(t),n=r.coordinates,o=e.properties?e.properties:"Feature"===t.type?t.properties:{},i=[];return n.forEach(function(t){i.push(q(t,o))}),y(i)}(r,e);default:throw new Error("invalid poly")}}function q(t,e){return t.length>1?function(t,e,r){return void 0===r&&(r={}),c({type:"MultiLineString",coordinates:t},e,r)}(t,e):h(t[0],e)}function Z(t,e){var r=!0;return m(t,function(t){m(e,function(e){if(!1===r)return!1;r=function(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return r=t.coordinates,n=e.coordinates,!(r[0]===n[0]&&r[1]===n[1]);case"LineString":return!J(e,t);case"Polygon":return!b(t,e)}break;case"LineString":switch(e.type){case"Point":return!J(t,e);case"LineString":return!function(t,e){if(N(t,e).features.length>0)return!0;return!1}(t,e);case"Polygon":return!D(e,t)}break;case"Polygon":switch(e.type){case"Point":return!b(e,t);case"LineString":return!D(t,e);case"Polygon":return!function(t,e){for(var r=0,n=t.coordinates[0];r<n.length;r++){if(b(n[r],e))return!0}for(var o=0,i=e.coordinates[0];o<i.length;o++){if(b(i[o],t))return!0}var a=N($(t),$(e));if(a.features.length>0)return!0;return!1}(e,t)}}var r,n;return!1}(t.geometry,e.geometry)})}),r}function J(t,e){for(var r=0;r<t.coordinates.length-1;r++)if(U(t.coordinates[r],t.coordinates[r+1],e.coordinates))return!0;return!1}function D(t,e){for(var r=0,n=e.coordinates;r<n.length;r++){if(b(n[r],t))return!0}return N(e,$(t)).features.length>0}function U(t,e,r){var n=r[0]-t[0],o=r[1]-t[1],i=e[0]-t[0],a=e[1]-t[1];return 0===n*a-o*i&&(Math.abs(i)>=Math.abs(a)?i>0?t[0]<=r[0]&&r[0]<=e[0]:e[0]<=r[0]&&r[0]<=t[0]:a>0?t[1]<=r[1]&&r[1]<=e[1]:e[1]<=r[1]&&r[1]<=t[1])}function W(t,e){var r=!1;return m(t,function(t){m(e,function(e){if(!0===r)return!0;r=!Z(t.geometry,e.geometry)})}),r}const H=Math.PI/180;function K(t,e,r){var n=function(t,e,r){var n=Math.sin(e*H),o=Math.pow(2,r),i=o*(t/360+.5),a=o*(.5-.25*Math.log((1+n)/(1-n))/Math.PI);(i%=o)<0&&(i+=o);return[i,a,r]}(t,e,r);return n[0]=Math.floor(n[0]),n[1]=Math.floor(n[1]),n}class Q{constructor(t,e){if("string"==typeof t){let e=function(t){const e=t.match(/^\/?(\d+)\/(?:(\d+)\/)?(\d+)\/(\d+)$/);if(e)return{z:parseInt(e[1],10),f:parseInt(e[2]||"0",10),x:parseInt(e[3],10),y:parseInt(e[4],10)}}(t)||function(t){if(null==t)throw new Error("parseZFXYTilehash: tilehash が未定義です");let e=!1,r=t.trim();if(r.startsWith("-")&&(e=!0,r=r.slice(1)),0===r.length)throw new Error("parseZFXYTilehash: '-' のみ、または空文字です");let n=o(),i=null;for(const t of r){const e=Number(t)-1;if(!Number.isInteger(e)||e<0||e>=n.length)throw new Error(`parseZFXYTilehash: 文字 '${t}' が不正です（範囲外または非数字）`);i={...n[e]},n=o(i)}if(!i)throw new Error("parseZFXYTilehash: lastChild が得られませんでした");return e&&(i.f=-Math.abs(i.f)),i}(t);if(!e)throw new Error(`parse ZFXY failed with input: ${t}`);return this.zfxy=e,void this._regenerateAttributesFromZFXY()}if("z"in(r=t)&&"f"in r&&"x"in r&&"y"in r)return this.zfxy=t,void this._regenerateAttributesFromZFXY();var r;this.zfxy=function(t){const e=void 0!==t.alt?t.alt:0;if(e<=-33554432||e>=33554432)throw new Error("ZFXY only supports altitude between -2^25 and +2^25.");const r=Math.floor(2**t.zoom*e/33554432),n=Math.PI/180,o=Math.sin(t.lat*n),i=2**t.zoom;let a=i*(t.lng/360+.5);const s=i*(.5-.25*Math.log((1+o)/(1-o))/Math.PI);return a%=i,a<0&&(a+=i),{f:r,x:Math.floor(a),y:Math.floor(s),z:t.zoom}}({...t,zoom:void 0!==e?e:25}),this._regenerateAttributesFromZFXY()}up(t=1){return this.move({f:t})}down(t=1){return this.move({f:-t})}north(t=1){return this.move({y:t})}south(t=1){return this.move({y:-t})}east(t=1){return this.move({x:t})}west(t=1){return this.move({x:-t})}move(t){const e=new Q(this.zfxy);return e.zfxy=f({z:e.zfxy.z,f:e.zfxy.f+(t.f||0),x:e.zfxy.x+(t.x||0),y:e.zfxy.y+(t.y||0)}),e._regenerateAttributesFromZFXY(),e}parent(t){const e=void 0===t?1:this.zfxy.z-t;return new Q(n(this.zfxy,e))}children(){return o(this.zfxy).map(t=>new Q(t))}surroundings(){return[...i(this.zfxy).filter(({z:t,f:e,x:r,y:n})=>`/${t}/${e}/${r}/${n}`!==this.zfxyStr).map(t=>new Q(t)),...i(this.up().zfxy).map(t=>new Q(t)),...i(this.down().zfxy).map(t=>new Q(t))]}contains(t){const e=this.toGeoJSON(),r={type:"Point",coordinates:[t.lng,t.lat]},n=this.alt,o=l({...this.zfxy,f:this.zfxy.f+1});return W(e,r)&&(void 0!==t.alt!=!0||t.alt>=n&&t.alt<o)}toGeoJSON(){const[t,e]=u(this.zfxy);return{type:"Polygon",coordinates:[[[t.lng,t.lat],[t.lng,e.lat],[e.lng,e.lat],[e.lng,t.lat],[t.lng,t.lat]]]}}vertices3d(){const[t,e]=u(this.zfxy),r=l(this.zfxy),n=l({...this.zfxy,f:this.zfxy.f+1});return[[t.lng,t.lat,r],[t.lng,e.lat,r],[e.lng,e.lat,r],[e.lng,t.lat,r],[t.lng,t.lat,n],[t.lng,e.lat,n],[e.lng,e.lat,n],[e.lng,t.lat,n]]}static getSpaceById(t,e){return new Q(t,e)}static getSpaceByLocation(t,e){return new Q(t,e)}static getSpaceByZFXY(t){return new Q(t)}static boundingSpaceForGeometry(t,e){e=e||25;const r=function(t,e){const r=K(t[0],t[1],32),n=K(t[2],t[3],32),o=[r[0],r[1],n[0],n[1]],i=Math.min(function(t){for(let e=0;e<28;e++){const r=1<<32-(e+1);if((t[0]&r)!==(t[2]&r)||(t[1]&r)!==(t[3]&r))return e}return 28}(o),void 0!==e?e:28);return 0===i?[0,0,0]:[o[0]>>>32-i,o[1]>>>32-i,i]}(v(t),e),[n,o,i]=r;return new Q({x:n,y:o,z:i,f:0})}static spacesForGeometry(t,e){const r=e;if(0===r)return[new Q("0/0/0/0")];if("GeometryCollection"===t.type)throw new Error("GeometryCollection not supported");const n=v(t),o=K(n[0],n[1],32),i=K(n[2],n[3],32),a=Math.min(o[0],i[0])>>>32-r,s=Math.min(o[1],i[1])>>>32-r,u=(Math.max(i[0],o[0])>>>32-r)+1,l=(Math.max(i[1],o[1])>>>32-r)+1,f=[];for(let e=a;e<=u;e++)for(let n=s;n<=l;n++){const o=new Q({x:e,y:n,z:r,f:0});W(t,o.toGeoJSON())&&f.push(o)}return f}_regenerateAttributesFromZFXY(){var t;this.alt=l(this.zfxy),this.center={...s(t=this.zfxy),alt:l(t)+33554432/2**(t.z+1)},this.zoom=this.zfxy.z,this.id=this.tilehash=function(t){let{f:e,x:r,y:i,z:a}=t;const s=e;let u="";for(;a>0;){const t=n({f:Math.abs(e),x:r,y:i,z:a}),s=o(t).findIndex(t=>t.f===Math.abs(e)&&t.x===r&&t.y===i&&t.z===a);if(s<0)throw new Error("generateTilehash: 親の children に一致する子が見つかりません");u=String(s+1)+u,e=t.f,r=t.x,i=t.y,a=t.z}return(s<0?"-":"")+u}(this.zfxy),this.zfxyStr=`/${this.zfxy.z}/${this.zfxy.f}/${this.zfxy.x}/${this.zfxy.y}`}}t.Space=Q});
//# sourceMappingURL=index.umd.js.map
