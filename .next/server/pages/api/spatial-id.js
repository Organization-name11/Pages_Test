"use strict";(()=>{var t={};t.id=545,t.ids=[545],t.modules={145:t=>{t.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8460:t=>{t.exports=import("@turf/bbox")},3514:t=>{t.exports=import("@turf/boolean-intersects")},6249:(t,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function t(r,e){return e in r?r[e]:"then"in r&&"function"==typeof r.then?r.then(r=>t(r,e)):"function"==typeof r&&"default"===e?r:void 0}}})},1574:(t,r,e)=>{e.a(t,async(t,n)=>{try{e.r(r),e.d(r,{config:()=>u,default:()=>l,routeModule:()=>y});var o=e(1802),i=e(7153),a=e(6249),s=e(7746),f=t([s]);s=(f.then?(await f)():f)[0];let l=(0,a.l)(s,"default"),u=(0,a.l)(s,"config"),y=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/spatial-id",pathname:"/api/spatial-id",bundlePath:"",filename:""},userland:s});n()}catch(t){n(t)}})},5691:(t,r,e)=>{e.a(t,async(t,n)=>{try{e.d(r,{T:()=>y});var o=e(2181),i=e(7210),a=e(8460),s=e(3514),f=e(7412),l=t([a,s]);function u(t,r){if("number"!=typeof t||Number.isNaN(t))throw Error(`Expected number for '${r}', got ${String(t)}`);return t}[a,s]=l.then?(await l)():l;class y{constructor(t,r){if("string"==typeof t){let r=(0,o.U1)(t)||(0,i.j)(t);if(r)this.zfxy=r,this._regenerateAttributesFromZFXY();else throw Error(`parse ZFXY failed with input: ${t}`);return}if((0,o.vt)(t)){this.zfxy=t,this._regenerateAttributesFromZFXY();return}this.zfxy=(0,o.nR)({...t,zoom:void 0!==r?r:25}),this._regenerateAttributesFromZFXY()}up(t=1){return this.move({f:t})}down(t=1){return this.move({f:-t})}north(t=1){return this.move({y:t})}south(t=1){return this.move({y:-t})}east(t=1){return this.move({x:t})}west(t=1){return this.move({x:-t})}move(t){let r=new y(this.zfxy),e=u(r.zfxy.z,"zfxy.z"),n=u(r.zfxy.f,"zfxy.f")+(t.f??0),i=u(r.zfxy.x,"zfxy.x")+(t.x??0),a=u(r.zfxy.y,"zfxy.y")+(t.y??0);return r.zfxy=(0,o.IH)({z:e,f:n,x:i,y:a}),r._regenerateAttributesFromZFXY(),r}parent(t){let r=void 0===t?1:u(this.zfxy.z,"zfxy.z")-u(t,"atZoom");return new y((0,o.G_)(this.zfxy,r))}children(){return(0,o.G)(this.zfxy).map(t=>new y(t))}surroundings(){let t=(0,o.qh)(this.zfxy).filter(({z:t,f:r,x:e,y:n})=>`/${t}/${r}/${e}/${n}`!==this.zfxyStr).map(t=>new y(t)),r=(0,o.qh)(this.up().zfxy).map(t=>new y(t)),e=(0,o.qh)(this.down().zfxy).map(t=>new y(t));return[...t,...r,...e]}toPolygon(){let t=(0,o.jY)(this.zfxy),[r,e,n,i]=function(t){if(Array.isArray(t)&&4===t.length&&t.every(t=>"number"==typeof t))return t;if(Array.isArray(t)&&2===t.length){let r=t[0],e=t[1],n="number"==typeof r?.lng?r.lng:Array.isArray(r)?r[0]:void 0,o="number"==typeof r?.lat?r.lat:Array.isArray(r)?r[1]:void 0,i="number"==typeof e?.lng?e.lng:Array.isArray(e)?e[0]:void 0,a="number"==typeof e?.lat?e.lat:Array.isArray(e)?e[1]:void 0;return[u(n,"bbox.minX"),u(o,"bbox.minY"),u(i,"bbox.maxX"),u(a,"bbox.maxY")]}throw Error("Unsupported BBox format returned by getBBox()")}(t);return{type:"Polygon",coordinates:[[[r,e],[n,e],[n,i],[r,i],[r,e]]]}}intersects(t){let r=this.toPolygon();return(0,s.default)(r,t)}intersectingNeighbors(t){let r=(0,a.default)(t),e=(0,f.lV)(r),n=u(e[0],"repTile.x"),o=u(e[1],"repTile.y"),i=u(this.zfxy.z,"zfxy.z"),s="number"==typeof e[2]?e[2]:i;return new y({z:s,f:u(this.zfxy.f,"zfxy.f"),x:n,y:o}).surroundings().filter(r=>r.intersects(t))}static fromCenter(t,r=25){let e=u(r,"zoom");return new y(t,e)}static fromPoint(t,r,e,n=25){let o=u(t,"lng"),i=u(r,"lat"),a=u(n,"z"),s=u(e,"f"),l=(0,f.Dl)(o,i,a),h=u(l[0],"tile.x"),x=u(l[1],"tile.y");return new y({z:a,f:s,x:h,y:x})}_regenerateAttributesFromZFXY(){if(!this.zfxy)throw Error("zfxy is not set");let t=u(this.zfxy.z,"zfxy.z"),r=u(this.zfxy.f,"zfxy.f"),e=u(this.zfxy.x,"zfxy.x"),n=u(this.zfxy.y,"zfxy.y");this.zoom=t,this.zfxyStr=`/${t}/${r}/${e}/${n}`,this.tilehash=(0,i.i)({z:t,f:r,x:e,y:n}),this.id=this.tilehash;let a=(0,o.wL)({z:t,f:r,x:e,y:n});this.center=a,this.alt=u(a.alt,"center.alt")}}n()}catch(t){n(t)}})},7412:(t,r,e)=>{e.d(r,{Dl:()=>s,lV:()=>a});let n=Math.PI/180;function o(t,r){if("number"!=typeof t||Number.isNaN(t))throw Error(`Expected number for '${r}', got ${String(t)}`);return t}function i(t){let r=o(t[0],"bbox[0] (minX)");return[r,o(t[1],"bbox[1] (minY)"),o(t[2],"bbox[2] (maxX)"),o(t[3],"bbox[3] (maxY)")]}function a(t,r){let[e,n,o,a]=i(t),f=s(e,n,32),l=s(o,a,32),u=[f[0],f[1],l[0],l[1]],y=Math.min(function(t){let[r,e,n,o]=i(t);for(let t=0;t<28;t++){let i=1<<32-(t+1);if((r&i)!=(n&i)||(e&i)!=(o&i))return t}return 28}(u),void 0!==r?r:28);return 0===y?[0,0,0]:[u[0]>>>32-y,u[1]>>>32-y,y]}function s(t,r,e){let o,i,a;let s=(o=Math.sin(r*n),(a=(i=Math.pow(2,e))*(t/360+.5)%i)<0&&(a+=i),[a,i*(.5-.25*Math.log((1+o)/(1-o))/Math.PI),e]);return s[0]=Math.floor(s[0]),s[1]=Math.floor(s[1]),s}},2181:(t,r,e)=>{function n(t){return"z"in t&&"f"in t&&"x"in t&&"y"in t}e.d(r,{G:()=>s,G_:()=>a,IH:()=>z,U1:()=>l,jY:()=>h,nR:()=>x,qh:()=>f,vt:()=>n,wL:()=>y});let o={f:0,x:0,y:0,z:0},i=180/Math.PI;function a(t,r=1){let{f:e,x:n,y:o,z:i}=t;if(r<=0)throw Error("steps must be greater than 0");if(r>i)throw Error(`Getting parent tile of ${JSON.stringify(t)}, ${r} steps is not possible because it would go beyond the root tile (z=0)`);return{f:e>>r,x:n>>r,y:o>>r,z:i-r}}function s(t=o){let{f:r,x:e,y:n,z:i}=t;return[{f:2*r,x:2*e,y:2*n,z:i+1},{f:2*r,x:2*e+1,y:2*n,z:i+1},{f:2*r,x:2*e,y:2*n+1,z:i+1},{f:2*r,x:2*e+1,y:2*n+1,z:i+1},{f:2*r+1,x:2*e,y:2*n,z:i+1},{f:2*r+1,x:2*e+1,y:2*n,z:i+1},{f:2*r+1,x:2*e,y:2*n+1,z:i+1},{f:2*r+1,x:2*e+1,y:2*n+1,z:i+1}]}function f(t=o){let{f:r,x:e,y:n,z:i}=t;return[z({f:r,x:e,y:n,z:i}),z({f:r,x:e+1,y:n,z:i}),z({f:r,x:e,y:n+1,z:i}),z({f:r,x:e+1,y:n+1,z:i}),z({f:r,x:e-1,y:n,z:i}),z({f:r,x:e,y:n-1,z:i}),z({f:r,x:e-1,y:n-1,z:i}),z({f:r,x:e+1,y:n-1,z:i}),z({f:r,x:e-1,y:n+1,z:i})]}function l(t){let r=t.match(/^\/?(\d+)\/(?:(\d+)\/)?(\d+)\/(\d+)$/);if(!r)return;let e=r[1]??"",n=r[2]??"0",o=r[3]??"",i=r[4]??"";if(""===e||""===o||""===i)return;let a=parseInt(e,10),s=parseInt(n,10),f=parseInt(o,10),l=parseInt(i,10);if(![a,s,f,l].some(t=>Number.isNaN(t)))return{z:a,f:s,x:f,y:l}}function u(t){let r=Math.PI-2*Math.PI*t.y/Math.pow(2,t.z);return{lng:t.x/Math.pow(2,t.z)*360-180,lat:i*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))}}function y(t){var r;return{...u({x:2*(r=t).x+1,y:2*r.y+1,z:r.z+1,f:0}),alt:33554432*t.f/2**t.z+33554432/2**(t.z+1)}}function h(t){return[u(t),u({...t,y:t.y+1,x:t.x+1})]}function x(t){let r=void 0!==t.alt?t.alt:0;if(r<=-33554432||r>=33554432)throw Error("ZFXY only supports altitude between -2^25 and +2^25.");let e=Math.floor(2**t.zoom*r/33554432),n=Math.sin(t.lat*(Math.PI/180)),o=2**t.zoom,i=o*(t.lng/360+.5);return(i%=o)<0&&(i+=o),{f:e,x:Math.floor(i),y:Math.floor(o*(.5-.25*Math.log((1+n)/(1-n))/Math.PI)),z:t.zoom}}function z(t){let{z:r,f:e,x:n,y:o}=t;return{z:r,f:Math.max(Math.min(e,2**r),-(2**r)),x:n<0?n+2**r:n%2**r,y:o<0?o+2**r:o%2**r}}},7210:(t,r,e)=>{e.d(r,{i:()=>i,j:()=>o});var n=e(2181);function o(t){let r,e=!1;"-"===t[0]&&(e=!0,t=t.substring(1));let o=(0,n.G)();for(let i of t){let a=parseInt(i,10)-1;if(!Number.isFinite(a)||a<0||a>=o.length)throw Error(`Invalid tilehash character '${i}' in '${e?"-":""}${t}'`);let s=o.at(a);if(!s)throw Error(`Invalid tilehash character '${i}' in '${e?"-":""}${t}'`);r=s,o=(0,n.G)(r)}if(!r)throw Error(`Invalid tilehash '${e?"-":""}${t}'`);return e?{...r,f:-r.f}:r}function i(t){let{f:r,x:e,y:o,z:i}=t,a=r,s="";for(;i>0;){let t={f:Math.abs(r),x:e,y:o,z:i},a=(0,n.G_)(t),f=(0,n.G)(a).findIndex(t=>t.f===Math.abs(r)&&t.x===e&&t.y===o&&t.z===i);if(f<0)throw Error(`Could not determine position in parent for tile ${JSON.stringify(t)}`);s=(f+1).toString()+s,r=a.f,e=a.x,o=a.y,i=a.z}return(a<0?"-":"")+s}},7746:(t,r,e)=>{e.a(t,async(t,n)=>{try{e.r(r),e.d(r,{default:()=>f});var o=e(5691),i=t([o]);function a(t){if(void 0!==t)return Array.isArray(t)?t[0]:t}function s(t){t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type")}function f(t,r){if("OPTIONS"===t.method)return s(r),r.status(204).end();if("GET"!==t.method)return s(r),r.setHeader("Allow","GET, OPTIONS"),r.status(405).json({error:"Method Not Allowed"});try{s(r);let e=a(t.query.lat),n=a(t.query.lon),i=a(t.query.zoom)??"25",f=a(t.query.alt);if(!e||!n)return r.status(400).json({error:"lat と lon は必須です"});let l=parseFloat(e),u=parseFloat(n),y=parseInt(i,10),h=void 0!==f?parseFloat(f):void 0;if(!Number.isFinite(l)||!Number.isFinite(u))return r.status(400).json({error:"lat と lon は数値である必要があります"});if(!Number.isFinite(y))return r.status(400).json({error:"zoom は数値である必要があります"});if(void 0!==f&&!Number.isFinite(h))return r.status(400).json({error:"alt が指定されている場合は数値である必要があります"});if(l<-85.0511287798||l>85.0511287798)return r.status(400).json({error:"lat の範囲は \xb185.0511287798"});if(u<-180||u>180)return r.status(400).json({error:"lon の範囲は \xb1180"});if(y<0||y>35)return r.status(400).json({error:"zoom は 0〜35"});let x=new o.T(void 0===h?{lng:u,lat:l}:{lng:u,lat:l,alt:h},y);return r.status(200).json({result:{zfxyStr:x.zfxyStr,tilehash:x.tilehash,zfxy:x.zfxy,zoom:x.zoom,center:x.center,alt:x.alt}})}catch(t){return console.error("[api/spatial-id] error:",t),s(r),r.status(500).json({error:String(t)})}}o=(i.then?(await i)():i)[0],n()}catch(t){n(t)}})},7153:(t,r)=>{var e;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return e}}),function(t){t.PAGES="PAGES",t.PAGES_API="PAGES_API",t.APP_PAGE="APP_PAGE",t.APP_ROUTE="APP_ROUTE"}(e||(e={}))},1802:(t,r,e)=>{t.exports=e(145)}};var r=require("../../webpack-api-runtime.js");r.C(t);var e=r(r.s=1574);module.exports=e})();